<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue杂篇 | 追旅</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="

有段时间没用vue了，但这并不能减少我对vue的热爱，整理一下vue的知识，查漏补缺，内附原理、代码，篇幅可能过长

Vue、Re ...">
    
    <link rel="preload" href="/chJouBlog/assets/css/0.styles.1901127d.css" as="style"><link rel="preload" href="/chJouBlog/assets/js/app.a36f641d.js" as="script"><link rel="preload" href="/chJouBlog/assets/js/15.7ee24ca2.js" as="script"><link rel="preload" href="/chJouBlog/assets/js/3.cd33b386.js" as="script"><link rel="preload" href="/chJouBlog/assets/js/27.5a038b7d.js" as="script"><link rel="prefetch" href="/chJouBlog/assets/js/10.c6368c74.js"><link rel="prefetch" href="/chJouBlog/assets/js/11.a8ec02c4.js"><link rel="prefetch" href="/chJouBlog/assets/js/12.6cefaccc.js"><link rel="prefetch" href="/chJouBlog/assets/js/13.b88ab42b.js"><link rel="prefetch" href="/chJouBlog/assets/js/14.f9a9da5e.js"><link rel="prefetch" href="/chJouBlog/assets/js/16.714c8ab3.js"><link rel="prefetch" href="/chJouBlog/assets/js/17.3aad3096.js"><link rel="prefetch" href="/chJouBlog/assets/js/18.a4de0435.js"><link rel="prefetch" href="/chJouBlog/assets/js/19.ae6c309e.js"><link rel="prefetch" href="/chJouBlog/assets/js/20.f6ee0b40.js"><link rel="prefetch" href="/chJouBlog/assets/js/21.cf5ffec8.js"><link rel="prefetch" href="/chJouBlog/assets/js/22.44c369cd.js"><link rel="prefetch" href="/chJouBlog/assets/js/23.ffe453e8.js"><link rel="prefetch" href="/chJouBlog/assets/js/24.e4a1f82e.js"><link rel="prefetch" href="/chJouBlog/assets/js/25.6f0c72db.js"><link rel="prefetch" href="/chJouBlog/assets/js/26.4bbd656a.js"><link rel="prefetch" href="/chJouBlog/assets/js/28.5ec041ad.js"><link rel="prefetch" href="/chJouBlog/assets/js/29.aef25dfc.js"><link rel="prefetch" href="/chJouBlog/assets/js/30.aae5e53b.js"><link rel="prefetch" href="/chJouBlog/assets/js/31.7b89c6d9.js"><link rel="prefetch" href="/chJouBlog/assets/js/32.d16b548b.js"><link rel="prefetch" href="/chJouBlog/assets/js/33.2c59bcf8.js"><link rel="prefetch" href="/chJouBlog/assets/js/34.c33faf48.js"><link rel="prefetch" href="/chJouBlog/assets/js/35.e89633d4.js"><link rel="prefetch" href="/chJouBlog/assets/js/36.c93a3817.js"><link rel="prefetch" href="/chJouBlog/assets/js/37.e549d223.js"><link rel="prefetch" href="/chJouBlog/assets/js/38.d9053b1b.js"><link rel="prefetch" href="/chJouBlog/assets/js/39.ec462db4.js"><link rel="prefetch" href="/chJouBlog/assets/js/4.2ea81dd3.js"><link rel="prefetch" href="/chJouBlog/assets/js/40.0c2eed10.js"><link rel="prefetch" href="/chJouBlog/assets/js/41.26525109.js"><link rel="prefetch" href="/chJouBlog/assets/js/42.32ab32aa.js"><link rel="prefetch" href="/chJouBlog/assets/js/43.cdcbaf48.js"><link rel="prefetch" href="/chJouBlog/assets/js/44.594b98bf.js"><link rel="prefetch" href="/chJouBlog/assets/js/45.74c4b0e4.js"><link rel="prefetch" href="/chJouBlog/assets/js/46.65e70775.js"><link rel="prefetch" href="/chJouBlog/assets/js/47.c15916ad.js"><link rel="prefetch" href="/chJouBlog/assets/js/48.61e2167a.js"><link rel="prefetch" href="/chJouBlog/assets/js/49.ad5852c5.js"><link rel="prefetch" href="/chJouBlog/assets/js/5.64f7a818.js"><link rel="prefetch" href="/chJouBlog/assets/js/50.d6cdd5e6.js"><link rel="prefetch" href="/chJouBlog/assets/js/51.40c9b5a8.js"><link rel="prefetch" href="/chJouBlog/assets/js/52.da9f9044.js"><link rel="prefetch" href="/chJouBlog/assets/js/53.6d71ff58.js"><link rel="prefetch" href="/chJouBlog/assets/js/54.f18c03b5.js"><link rel="prefetch" href="/chJouBlog/assets/js/55.2d2a0099.js"><link rel="prefetch" href="/chJouBlog/assets/js/56.2e8a7cc8.js"><link rel="prefetch" href="/chJouBlog/assets/js/57.4208e2ed.js"><link rel="prefetch" href="/chJouBlog/assets/js/58.d61ea6da.js"><link rel="prefetch" href="/chJouBlog/assets/js/59.58c410a3.js"><link rel="prefetch" href="/chJouBlog/assets/js/6.7f6de3bc.js"><link rel="prefetch" href="/chJouBlog/assets/js/60.54533de0.js"><link rel="prefetch" href="/chJouBlog/assets/js/61.c9bb076b.js"><link rel="prefetch" href="/chJouBlog/assets/js/62.c5d2498d.js"><link rel="prefetch" href="/chJouBlog/assets/js/63.8ffd86f6.js"><link rel="prefetch" href="/chJouBlog/assets/js/64.a5eee671.js"><link rel="prefetch" href="/chJouBlog/assets/js/65.4d61378f.js"><link rel="prefetch" href="/chJouBlog/assets/js/66.907aa881.js"><link rel="prefetch" href="/chJouBlog/assets/js/67.f0bb0ca9.js"><link rel="prefetch" href="/chJouBlog/assets/js/68.931d4dd2.js"><link rel="prefetch" href="/chJouBlog/assets/js/69.a095ca0a.js"><link rel="prefetch" href="/chJouBlog/assets/js/7.b5195633.js"><link rel="prefetch" href="/chJouBlog/assets/js/70.62f3d03b.js"><link rel="prefetch" href="/chJouBlog/assets/js/71.be51a30b.js"><link rel="prefetch" href="/chJouBlog/assets/js/72.61fdda19.js"><link rel="prefetch" href="/chJouBlog/assets/js/73.77c1ffe5.js"><link rel="prefetch" href="/chJouBlog/assets/js/74.bb9e9918.js"><link rel="prefetch" href="/chJouBlog/assets/js/75.866715ff.js"><link rel="prefetch" href="/chJouBlog/assets/js/76.10ac86e9.js"><link rel="prefetch" href="/chJouBlog/assets/js/77.b562b49d.js"><link rel="prefetch" href="/chJouBlog/assets/js/78.f8b3f886.js"><link rel="prefetch" href="/chJouBlog/assets/js/79.823e10dd.js"><link rel="prefetch" href="/chJouBlog/assets/js/8.623f0f3c.js"><link rel="prefetch" href="/chJouBlog/assets/js/80.f4e20ecd.js"><link rel="prefetch" href="/chJouBlog/assets/js/81.0c7a0f69.js"><link rel="prefetch" href="/chJouBlog/assets/js/82.fa9ec868.js"><link rel="prefetch" href="/chJouBlog/assets/js/83.e1664d86.js"><link rel="prefetch" href="/chJouBlog/assets/js/84.f08c664f.js"><link rel="prefetch" href="/chJouBlog/assets/js/85.fc23f700.js"><link rel="prefetch" href="/chJouBlog/assets/js/86.96ef4110.js"><link rel="prefetch" href="/chJouBlog/assets/js/9.00fca24d.js"><link rel="prefetch" href="/chJouBlog/assets/js/vuejs-paginate.58df4919.js">
    <link rel="stylesheet" href="/chJouBlog/assets/css/0.styles.1901127d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/chJouBlog/" class="nav-link home-link">追旅 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/chJouBlog/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/chJouBlog/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="/chJouBlog/author.html" class="nav-link">Author</a></li><li class="nav-item"><a href="/chJouBlog/log.html" class="nav-link">Log</a></li><li class="nav-item"><a href="https://github.com/xwei111/chJouBlog" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li><li class="nav-item"><a href="https://xwei111.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">XW-UI</a></li><li class="nav-item"><a href="https://ludd.link" target="_blank" rel="noopener noreferrer" class="nav-link external">Ludd</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/chJouBlog/" class="nav-link mobile-home-link">追旅 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/chJouBlog/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/chJouBlog/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="/chJouBlog/author.html" class="nav-link">Author</a></li><li class="mobile-nav-item"><a href="/chJouBlog/log.html" class="nav-link">Log</a></li><li class="mobile-nav-item"><a href="https://github.com/xwei111/chJouBlog" target="_blank" rel="noopener noreferrer" class="nav-link external">GitHub</a></li><li class="mobile-nav-item"><a href="https://xwei111.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">XW-UI</a></li><li class="mobile-nav-item"><a href="https://ludd.link" target="_blank" rel="noopener noreferrer" class="nav-link external">Ludd</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Vue杂篇
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">追旅</span> <span itemprop="address">   in 杭州滨江</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2021-01-13T00:00:00.000Z">
      Wed Jan 13 2021
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/chJouBlog/tag/vue" data-v-42ccfcd5><span data-v-42ccfcd5>vue</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>有段时间没用vue了，但这并不能减少我对vue的热爱，整理一下vue的知识，查漏补缺，内附原理、代码，篇幅可能过长</p> <h2 id="vue、react异同"><a href="#vue、react异同" class="header-anchor">#</a> Vue、React异同</h2> <p>相同：</p> <ol><li>使用了虚拟DOM</li> <li>提供响应式和组件化的视图组件</li> <li>将注意力集中保持在核心库，而将其他功能如路由和全局状态管理交给相关的库</li> <li>提供生命周期钩子函数，开发者按需定制需求</li></ol> <p>差异：</p> <ol><li><code>Vue</code>本质是MVVM框架，<code>React</code>是前端组件化框架</li> <li><code>Vue</code>推崇模板，但也支持<code>JSX</code>语法，<code>React</code>支持<code>JSX</code>语法</li> <li><code>Vue</code>提供了指令、过滤器等，方便操作，<code>React</code>没有</li> <li><code>Vue</code>支持数据双向绑定</li> <li><code>Vue</code>会跟踪每一个组件的依赖关系，不需要重新渲染整个组件树。<code>React</code>在应用的状态被改变时，全部子组件都会重新渲染。通过<code>shouldComponentUpdate</code>这个生命周期方法可以进行控制，但<code>Vue</code>将此视为默认的优化</li> <li>CSS作用域在<code>React</code>中是通过CSS-in-JS的方案实现的，<code>Vue</code>通过scoped</li> <li><code>Vue</code>中子组件向父组件传递消息有两种方式：事件和回调函数，<code>Vue</code>更倾向于使用事件。在<code>React</code>中我们都是使用回调函数的</li></ol> <h2 id="mvvm是什么-和mvc区别"><a href="#mvvm是什么-和mvc区别" class="header-anchor">#</a> MVVM是什么?和MVC区别?</h2> <ul><li>MVC</li></ul> <p><code>MVC</code>是<code>Model-View-Controller</code>缩写，<code>Model</code>即数据模型，负责数据库中数据的存取，<code>View</code>即视图，也就是页面上看到的，<code>MVC</code>的思想就是既不能在<code>Model</code>里面写<code>View</code>相关代码，也不能在<code>View</code>里面写<code>Model</code>相关代码，所以将同步<code>Model</code>和<code>View</code>的工作就交给了<code>Controller</code>，在数据简单的年代<code>Controller</code>负担起数据解析的工作毫无压力，但随着数据结构变得越来越复杂，<code>Controller</code>就变得非常臃肿，接下来引出了<code>MVVM</code>，将数据解析的工作交给了<code>VM</code></p> <ul><li>MVVM</li></ul> <p><code>MVVM</code>是<code>Model-View-ViewModle</code>缩写，最早由微软提出</p> <p><code>Model</code>代表数据层，<code>View</code>代表视图层，负责展示数据，<code>ViewModle</code>则负责同步<code>Model</code>和<code>View</code>之间的关联，其实现同步关联的核心是<code>DOMListeners</code>和 <code>DataBindings</code>两个工具，<code>DOMListeners</code> 工具用于监听 <code>View</code> 中 <code>DOM</code> 的变化，并会选择性的传给 <code>Model</code>；<code>DataBindings</code> 工具用于监听 <code>Model</code> 数据变化，并将其更新给 <code>View</code></p> <p><code>MVVM``设计思想就是将复杂的``DOM</code>中解脱出来，开发者从如何操作<code>DOM</code>变成了如何更新JS对象状态</p> <p>想要更详细的了解请看<a href="https://www.jianshu.com/p/b0aab1ffad93" target="_blank" rel="noopener noreferrer">mvc和mvvm的区别<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <ol><li>创建阶段</li></ol> <ul><li>BeforeCreate(组件创建前)</li></ul> <p>实例初始化后，数据监测(data observer)、watch/event事件配置调用之前，此阶段$el和data为undefined</p> <ul><li>Created(组件创建后)</li></ul> <p>数据观测、事件配置已完成。data对象可访问，但$el还无法访问，ref为undefined，常用来做数据初始化、ajax等操作</p> <ol start="2"><li>挂载阶段</li></ol> <ul><li>BeforeMount(组件挂载前)</li></ul> <p>该函数在组件挂载前调用，此时 HTML 模板编译已完成，虚拟 DOM 已存在，$el 为可用状态，但 ref 仍不可用</p> <ul><li>Mounted(组件挂载后)</li></ul> <p>组件挂载完成，数据渲染完成。DOM可以访问，此阶段只执行一次</p> <ol start="3"><li>更新阶段</li></ol> <ul><li>BeforeUpdate(更新前)</li></ul> <p>数据更新、虚拟 DOM 打补丁前调用，此阶段可以访问到当前现有DOM</p> <ul><li>Updated(更新后)</li></ul> <p>数据更新、虚拟 DOM 打补丁后调用</p> <ol start="4"><li>卸载阶段</li></ol> <ul><li>BeforeDestory(卸载前)</li></ul> <p>在实例销毁前调用，可通过this获取实例，ref 仍然存在，此阶段通常用来清除定时器和绑定的监听事件</p> <ul><li>Destroyed(卸载后)</li></ul> <p>实例被销毁，所有指令均被解绑，所有事件监听器移除</p> <ol start="5"><li>keep-alive钩子函数</li></ol> <ul><li>activated</li></ul> <p>在被keep-alive缓存的组件激活时调用</p> <ul><li>deactivate</li></ul> <p>在被keep-alive缓存的组件停用时调用。</p> <h2 id="子父组件通信"><a href="#子父组件通信" class="header-anchor">#</a> 子父组件通信</h2> <ol><li>父组件-&gt;子组件</li></ol> <ul><li>props</li> <li>provide/inject</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// provide向所有后代组件注入依赖</span>
<span class="token comment">// provide 和 inject 绑定并不是可响应的</span>
<span class="token comment">// 如果你传入了一个可监听的对象，那么其对象的 property 还是可响应的</span>
<span class="token comment">// parent</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">obj</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token string">&quot;女&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">obj</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">,</span> <span class="token comment">// obj响应</span>
            <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sex <span class="token comment">// sex非响应</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
<span class="token comment">// child</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'obj'</span><span class="token punctuation">,</span> <span class="token string">'sex'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>$attrs</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 接收所有父组件除class和style且不作为prop识别的attribute绑定</span>
<span class="token comment">// parent</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Child <span class="token operator">:</span>sex<span class="token operator">=</span><span class="token string">&quot;'女'&quot;</span> <span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;'老王'&quot;</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">&quot;{}&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token comment">// Child</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">)</span> <span class="token comment">// { sex: &quot;女&quot; }</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>$listeners</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 包含了父作用域中的 (不含 .native 修饰器的)v-on事件监听器</span>
<span class="token comment">// parent</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Child1 @click1<span class="token operator">=</span><span class="token string">&quot;click1&quot;</span> @click2<span class="token operator">=</span><span class="token string">&quot;click2&quot;</span> @click3<span class="token operator">=</span><span class="token string">&quot;click3&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token comment">// child1</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Child2 v<span class="token operator">-</span>on<span class="token operator">=</span><span class="token string">&quot;$listeners&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token comment">// 向下传递Child1绑定的事件</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$listeners<span class="token punctuation">)</span> <span class="token comment">// { click1: f, click2: f, click3: f }</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">click1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>'click1<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// child2</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$listeners<span class="token punctuation">)</span> <span class="token comment">// { click1: f, click2: f, click3: f }</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">click2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;click2&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">click3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">&quot;click3&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>子组件-&gt;父组件</li></ol> <ul><li>回调函数</li> <li>$emit</li></ul> <ol start="3"><li>兄弟组件</li></ol> <ul><li>状态提升到父组件</li></ul> <ol start="4"><li>通用</li></ol> <ul><li>vuex</li> <li>bus事件总线</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// main.js</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 发出</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token number">666</span><span class="token punctuation">)</span>
<span class="token comment">// 接收</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 666</span>
</code></pre></div><h2 id="双向绑定原理"><a href="#双向绑定原理" class="header-anchor">#</a> 双向绑定原理</h2> <p><code>Vue</code>采用的是数据劫持 + 订阅者发布者模式，数据劫持是通过<code>Object.defineProperty</code>为组件<code>data</code>每个属性添加<code>get</code>和<code>set</code>方法，在数据发生变化时触发<code>set</code>中的监听回调，通知给订阅者</p> <p><span style="color:#E6A23C;">第一步：递归遍历数据（data），通过Object.defineProperty为属性添加getter和setter</span></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">Observer</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">walk</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            self<span class="token punctuation">.</span><span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">defineReactive</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> childObj <span class="token operator">=</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对象递归</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value <span class="token operator">||</span> <span class="token keyword">typeof</span> value <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><span style="color:#E6A23C;">第二步：dep作为观察者(收集依赖，发布消息)会在调用getter时注册函数，在调用setter时通知执行注册的函数</span></p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注册函数，收集依赖</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> val<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> val<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
        dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发update更新，发布消息</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Dep</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">addSub</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">notify</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// watcher提供update方法</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><span style="color:#E6A23C;">第三步：Compile解析模板指令，将其中的变量替换成数据。然后初始化渲染页面视图，并将每个指令对应的节点绑定上更新函数、监听函数。后续一旦数据发生变化，便会更新页面。页面发生变化时也会相应发布变动信息</span></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Compile</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fragment <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Compile</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>fragment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">nodeToFragment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compileElement</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Dom元素不存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">nodeToFragment</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> child <span class="token operator">=</span> el<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>child<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 将Dom元素移入fragment中</span>
            fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
            child <span class="token operator">=</span> el<span class="token punctuation">.</span>firstChild
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> fragment<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">compileElement</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> childNodes <span class="token operator">=</span> el<span class="token punctuation">.</span>childNodes<span class="token punctuation">;</span>
        <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\{\{(.*)\}\}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> text <span class="token operator">=</span> node<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token function">isElementNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                <span class="token comment">// 节点</span>
                self<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token function">isTextNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 是否是符合这种形式{{}}的指令,解析模板</span>
                self<span class="token punctuation">.</span><span class="token function">compileText</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> reg<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 递归子节点</span>
                self<span class="token punctuation">.</span><span class="token function">compileElement</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">compile</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> nodeAttrs <span class="token operator">=</span> node<span class="token punctuation">.</span>attributes<span class="token punctuation">;</span>
        <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>nodeAttrs<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> attrName <span class="token operator">=</span> attr<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token function">isDirective</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> exp <span class="token operator">=</span> attr<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                <span class="token keyword">var</span> dir <span class="token operator">=</span> attrName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token function">isEventDirective</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                    <span class="token comment">// 事件指令</span>
                    self<span class="token punctuation">.</span><span class="token function">compileEvent</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> self<span class="token punctuation">.</span>vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  
                    <span class="token comment">// v-model 指令</span>
                    self<span class="token punctuation">.</span><span class="token function">compileModel</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> self<span class="token punctuation">.</span>vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                node<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">compileText</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> exp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> initText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>exp<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 将初始化的数据初始化到视图中</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateText</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> initText<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">// 生成订阅器并绑定更新函数，Watcher中updaue会触发该事件</span>
        <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            self<span class="token punctuation">.</span><span class="token function">updateText</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">compileEvent</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> eventType <span class="token operator">=</span> dir<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> cb <span class="token operator">=</span> vm<span class="token punctuation">.</span>methods <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>methods<span class="token punctuation">[</span>exp<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventType <span class="token operator">&amp;&amp;</span> cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">compileModel</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>exp<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">modelUpdater</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            self<span class="token punctuation">.</span><span class="token function">modelUpdater</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 监听input事件，视图变化更新data数据</span>
        node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> newValue <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            self<span class="token punctuation">.</span>vm<span class="token punctuation">[</span>exp<span class="token punctuation">]</span> <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
            val <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">updateText</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token keyword">typeof</span> value <span class="token operator">==</span> <span class="token string">'undefined'</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">modelUpdater</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">typeof</span> value <span class="token operator">==</span> <span class="token string">'undefined'</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">isDirective</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> attr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'v-'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">isEventDirective</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> dir<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'on:'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">isElementNode</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">isTextNode</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> node<span class="token punctuation">.</span>nodeType <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><span style="color:#E6A23C;">第四步：Watcher订阅者作为Observer和Compile之间的桥梁，实例化时将自己添加到dep中，提供一个update方法待数据变化时触发Compile中的相应函数完成更新</span></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Watcher</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>exp <span class="token operator">=</span> exp<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将自己添加到订阅器dep</span>
<span class="token punctuation">}</span>

<span class="token class-name">Watcher</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">run</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>exp<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> oldVal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 触发Compile中的相应更新视图函数</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token comment">// 缓存自己</span>
        <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>exp<span class="token punctuation">]</span>  <span class="token comment">// 强制执行监听器里的get函数</span>
        Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">// 释放自己</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h2 id="computed、watch差异"><a href="#computed、watch差异" class="header-anchor">#</a> computed、watch差异</h2> <ul><li>Computed:</li></ul> <ol><li>计算属性</li> <li>支持缓存，只有依赖的数据发生变化时才会重新计算</li> <li>不支持异步操作</li> <li>自动监听依赖值的变化，从而动态返回内容</li></ol> <p>通常一个值依赖于其他多个值计算而来的话我们会使用Computed，Computed默认具有getter，setter则需要手动写，如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">{</span>  
        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num1 <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num2
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">set</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'do somethings'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Watch</li></ul> <ol><li>监听</li> <li>不支持缓存</li> <li>可进行异步操作</li> <li>监听是一个过程，在监听的值变化时，可以触发一个回调</li></ol> <p>Watch如果需要在组件加载立即出发需要将immediate设置为ture，如果需要监听深层次的属性需要将deep设置为true</p> <p><span style="color:#F56C6C;">需要注意的是一旦添加deep则所有属性将被监听，非常的耗性能，所以通常会优化一下只监听需要被监听的属性，如：obj.a，例外一个问题：不是添加了deep所有的操作都会被监听到，如对象新增属性obj.newAttr = 1、数组arr[0] = 1这样的操作，只有那些响应式的方式才能被监听到，如push、pop等</span></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">obj</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newVal<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="异步队列、-nexttick"><a href="#异步队列、-nexttick" class="header-anchor">#</a> 异步队列、$nextTick</h2> <p><code>Vue</code>中数据发生变化时，并不会立即更新<code>DOM</code>，通常会使用一个for循环去测试，这样做是为了避免不必要的计算和DOM操作。</p> <p>每个Watcher都有一个唯一id，当同一个Watcher被多次被触发，会根据id判断是否存在，避免重复推入队列，这是Vue做的优化，去重之后的队列中的Watcher则是需要被执行的，但这个队列是不会被立即执行的，会在下一个事件循环tick执行也就是我们说的nextTick，所以我们先看一下Vue中nextTick的实现，了解了nextTick，其实异步队列更新也就差不多了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// flushCallbacks，执行所有的任务</span>
<span class="token keyword">const</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">function</span> <span class="token function">flushCallbacks</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  pending <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 为了兼容，使用顺序是Promise-&gt;MutationObserver-&gt;setImmediate-&gt;setTimeout</span>
<span class="token comment">// 将任务放到微任务或者宏任务中执行,所有flushCallbacks中同步任务执行完毕执行异步任务</span>
<span class="token comment">// timerFunc</span>
<span class="token keyword">let</span> timerFunc<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isIOS<span class="token punctuation">)</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>noop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
<span class="token operator">!</span>isIE <span class="token operator">&amp;&amp;</span>
<span class="token keyword">typeof</span> MutationObserver <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">&amp;&amp;</span>
<span class="token punctuation">(</span><span class="token function">isNative</span><span class="token punctuation">(</span>MutationObserver<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token comment">// PhantomJS and iOS 7.x</span>
    MutationObserver<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span>
    <span class="token string">&quot;[object MutationObserverConstructor]&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">characterData</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        counter <span class="token operator">=</span> <span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">;</span>
        textNode<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    isUsingMicroTask <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
<span class="token keyword">typeof</span> setImmediate <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">&amp;&amp;</span>
<span class="token function">isNative</span><span class="token punctuation">(</span>setImmediate<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setImmediate</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// nextTick</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span> <span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _resolve
    <span class="token comment">// 收集任务，等待执行</span>
    callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 防止后续的 nextTick 重复执行 timerFunc</span>
        pending <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">// 执行任务</span>
        <span class="token function">timerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ok，接下来是异步任务队里</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// update更新</span>
<span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 各种情况的判断 ...  </span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// this 为当前的实例 watcher</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// queueWatcher</span>
<span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> has <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> waiting <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> flushing <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">watcher</span><span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
    <span class="token comment">// 判断id是否存在，去重操作  </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> i <span class="token operator">=</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> index <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">&gt;</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                i<span class="token operator">--</span>
            <span class="token punctuation">}</span>
            queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            waiting <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token comment">// 下一个tick执行任务，flushSchedulerQueue在nextTick中会添加到callbacks中</span>
            <span class="token function">nextTick</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// flushSchedulerQueue</span>
<span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentFlushTimestamp <span class="token operator">=</span> <span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    flushing <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">let</span> watcher<span class="token punctuation">,</span> id
    queue<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>id <span class="token operator">-</span> b<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        watcher <span class="token operator">=</span> queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>before<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            watcher<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
        has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        watcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 执行更新任务</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到不仅是我们日常开发会使用nextTick，对于Vue来说也是它的Api，要理解这些你要对js执行机制有一些了解</p> <h2 id="v-for中key的作用"><a href="#v-for中key的作用" class="header-anchor">#</a> v-for中key的作用</h2> <p>为什么使用key呢？很简单，就是因为Vue追踪DOM的变化依赖一个标识（针对的是动态DOM），对于一个DOM的是新生的还是变换了位置，没有一个唯一标识去追踪，神仙也不可能知道这些变化，说白了就是给DOM一个身份，因为DOM中一样的标签如：div、p等他们看起来就像是克隆人，你无法识别，为啥要给个身份？其实是还是为了优化，优化的是diff算法，添加key和不添加key计算出来的补丁是完全不一样的，我把之前一篇文章的例子拿过来看一下（了解更多请看<a href="https://chasejourney.top/chJouBlog/2020/07/29/virtual-dom/" target="_blank" rel="noopener noreferrer">Virtual Dom 及 Diff 算法初探<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> oldData <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'ul'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token comment">// 标识  ul: 0</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//  li: 1    aaa: 2</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'bbb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// li: 3    bbb: 4</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ccc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//  li: 5    ccc: 6</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> newData <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'ul'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'bbb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ccc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> patches <span class="token operator">=</span> <span class="token function">diff</span><span class="token punctuation">(</span>oldData<span class="token punctuation">,</span> newData<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'patches----------'</span><span class="token punctuation">,</span> patches<span class="token punctuation">)</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="An image"></p> <p>根据<code>patches</code>结果，我们可以看出相应标识节点发生的变化，再来看一组数据</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> oldData <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'ul'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'bbb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ccc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> newData <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'ul'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'bbb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ccc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> patches <span class="token operator">=</span> <span class="token function">diff</span><span class="token punctuation">(</span>oldData<span class="token punctuation">,</span> newData<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'patches----------'</span><span class="token punctuation">,</span> patches<span class="token punctuation">)</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="An image"></p> <p>可以看出不加key的补丁确实复杂了很多，日常复杂操作中又不知道要复杂多少倍</p> <p>另外一个问题是for循环中尽量避免自带的index索引，因为一个元素变化会导致后续所有DOM表示发生了变化，导致补丁变复杂，更新效率也变差</p> <h2 id="v-if、v-show差异"><a href="#v-if、v-show差异" class="header-anchor">#</a> v-if、v-show差异</h2> <p>优化是无处不在的，分清<code>v-if</code>、<code>v-show</code>也是为了优化</p> <ul><li>v-if</li></ul> <p><code>真正</code>的条件渲染，对DOM销毁或重建，耗性能，切换过程中条件块内的事件监听器和子组件适当地被销毁和重建</p> <p>另外<code>v-for</code>具有比<code>v-if</code> 更高的优先级，同时使用也会造成性能问题，通常用<code>computed</code>或<code>v-show</code>解决</p> <ul><li>v-show</li></ul> <p>简单的css切换（display），开销小，频繁切换常用</p> <h2 id="vue组件中data必须是函数"><a href="#vue组件中data必须是函数" class="header-anchor">#</a> Vue组件中data必须是函数</h2> <p>其实这也是个js的基础问题，因为同一对象被复用地址同一个会互相影响，也即是一个组件被多次引用这个数据就会乱掉，所以用函数返回一个新对象</p> <h2 id="vue初始化页面闪动问题"><a href="#vue初始化页面闪动问题" class="header-anchor">#</a> Vue初始化页面闪动问题</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- css --&gt;</span>
[v-cloak] { display: none; }
<span class="token comment">&lt;!-- html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-cloak</span><span class="token punctuation">&gt;</span></span>
  {{ message }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="vue、react路由模式"><a href="#vue、react路由模式" class="header-anchor">#</a> Vue、React路由模式</h2> <p>前端路由主要就是hash路由和history路由，<code>vue-router</code>和<code>react-router</code>亦是如此</p> <ul><li>hash路由</li></ul> <p>hash路由的url是带#号的，通过监听<code>hashchange</code>事件改变页面内容</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#/page1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>page1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#/page2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>page2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> app <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'onload'</span><span class="token punctuation">,</span><span class="token function">hashChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'hashchange'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">hashChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">hashChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'#/page1'</span><span class="token operator">:</span>
            app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page1'</span>
            <span class="token keyword">return</span>
        <span class="token keyword">case</span> <span class="token string">'#/page2'</span><span class="token operator">:</span>
            app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page2'</span>
            <span class="token keyword">return</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            app<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page1'</span>
            <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>history</li></ul> <p>history新增了<code>pushState</code>和<code>replaceState</code>（pushState是将传入url压入历史记录栈，replaceState将传入url替换当前历史记录栈），在当前已有的 back、forward、go 的基础之上，它们提供了对历史记录进行修改的功能。只是当它们执行修改时，虽然改变了当前的 URL，但浏览器不会立即向后端发送请求</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/page1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>page1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/page2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>page2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> Load<span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span> PopChange<span class="token punctuation">)</span>
<span class="token keyword">var</span> routeView <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">function</span> <span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    routeView <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span>
    <span class="token comment">// 默认执行一次 popstate 的回调函数</span>
    <span class="token function">PopChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> aList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'a[href]'</span><span class="token punctuation">)</span>
    aList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">aNode</span> <span class="token operator">=&gt;</span> aNode<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token keyword">var</span> href <span class="token operator">=</span> aNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>
        history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> href<span class="token punctuation">)</span>
        <span class="token comment">// popstate 是监听不到地址栏的变化，所以此处需要手动执行回调函数 PopChange</span>
        <span class="token function">PopChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">PopChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'/page1'</span><span class="token operator">:</span>
            routeView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page1'</span>
            <span class="token keyword">return</span>
        <span class="token keyword">case</span> <span class="token string">'/page2'</span><span class="token operator">:</span>
            routeView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page2'</span>
            <span class="token keyword">return</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            routeView<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'page1'</span>
            <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>history模式需要后台进行配置，当url无法匹配到静态资源时，返回同一个index.html，以nginx为例：</p> <div class="language-js extra-class"><pre class="language-js"><code>location <span class="token operator">/</span> <span class="token punctuation">{</span>
  try_files $uri $uri<span class="token operator">/</span> <span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><a href="https://router.vuejs.org/zh/guide/essentials/history-mode.html" target="_blank" rel="noopener noreferrer">后台配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="vue-router路由钩子函数"><a href="#vue-router路由钩子函数" class="header-anchor">#</a> vue-router路由钩子函数</h2> <p>通常会将路由钩子函数称之为路由守卫，守卫就是&quot;看大门的&quot;，谁要进来就要看这个&quot;看大门的&quot;让不让你进来了，如果你身份符合条件就会让你进来，也就是我们经常会做的一件事：身份验证，&quot;大门&quot;也要分很多种的，主大门，屋内小门等等，所以路由钩子自然也会做区分：</p> <ul><li>全局钩子</li></ul> <p>这是主大门的&quot;看门的&quot;，这里如果过不去，你怕是哪都去不了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 常用钩子：跳转前校验</span>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>独享钩子</li></ul> <p>深宫大院总有一些特殊身份的人，他特殊啊，所以他自然也独享一些&quot;看门的&quot;</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/foo'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">component</span><span class="token operator">:</span> Foo<span class="token punctuation">,</span>
      <span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>各组件钩子</li></ul> <p>各屋没那么特殊，但也会有个门，想进来也要看有没有&quot;看门的&quot;、&quot;看门的&quot;心情如何</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">beforeRouteEnter</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 进门前你是不知道主人是谁的，所以此阶段this为undefined</span>
    <span class="token function">beforeRouteLeave</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vue如何动态路由"><a href="#vue如何动态路由" class="header-anchor">#</a> Vue如何动态路由</h2> <ul><li>router提供的动态路由</li></ul> <p>无论<code>Vue</code>还是<code>React</code>都会提供<code>/:id</code>方式动态匹配，通常这种方式会用来实现匹配某一类相同结构的页面</p> <ul><li>动态权限路由</li></ul> <p>通常需要做权限控制就需要动态路由，有两种做法：</p> <ol><li><p>前端有一份全量的路由数据，然后根据请求后台的权限数据处理这份全量的路由的数据，将不符合条件的过滤掉不显示在菜单栏或页面其它地方，页面跳转的时候也通过路由守卫判断是否有权限，无权限则提示无权限</p></li> <li><p>将前端路由分为静态和动态两份，静态的如登录页、404等可以直接写到路由中，而动态部分由后端提供，前端拿到后通过<code>router.addRoutes</code>添加到前端路由中，这里会问一个问题是如果退出登录时如果直接使用<code>push</code>的话再次登录会遇到路由重复添加的问题，处理这个有两种方式：</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一、简单粗暴的使用window.location.href </span>
window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/login'</span>
<span class="token comment">// 二、每次添加路由前清空路由信息</span>
<span class="token comment">// router.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">createRouter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">resetRouter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newRouter <span class="token operator">=</span> <span class="token function">createRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  router<span class="token punctuation">.</span>matcher <span class="token operator">=</span> newRouter<span class="token punctuation">.</span>matcher 
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> router
<span class="token comment">// 后续调用addRoutes前先调用resetRouter</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>resetRouter<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/router'</span>
<span class="token function">resetRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span><span class="token function">addRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span>
</code></pre></div><h2 id="keep-alive"><a href="#keep-alive" class="header-anchor">#</a> keep-alive</h2> <p>缓存不活动的组件实例，而不是销毁它们，常见的例子就是<code>tabs</code>来回切换时个<code>tab</code>状态没有被初始化</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// include：值可为字符串、正则</span>
<span class="token comment">// 缓存组件名为a、b的组件，其余都不缓存</span>
<span class="token operator">&lt;</span>keep<span class="token operator">-</span>alive include<span class="token operator">=</span><span class="token string">&quot;a,b&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>component <span class="token operator">:</span>is<span class="token operator">=</span><span class="token string">&quot;view&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>component<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>keep<span class="token operator">-</span>alive<span class="token operator">&gt;</span>
<span class="token comment">// exclude值和include相同，意思相反，匹配到的都不缓存</span>
<span class="token comment">// max 最多缓存组件数量</span>

<span class="token comment">// 配合meta</span>
<span class="token operator">&lt;</span>keep<span class="token operator">-</span>alive<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>router<span class="token operator">-</span>view v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;$route.meta.keepAlive&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>keep<span class="token operator">-</span>alive<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>router<span class="token operator">-</span>view v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;$route.meta.keepAlive&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>router<span class="token operator">-</span>view<span class="token operator">&gt;</span>
</code></pre></div><p>以上是<code>keep-alive</code>的使用，接下来一起了解一下<code>keep-alive</code>的实现，<code>keep-alive</code>本身也是个组件，它是<code>Vue</code>内部实现的一个组件，但它不会被渲染，<code>keep-alive</code>内部有一个属性<code>{abstract: true}</code>，<code>abstract</code>为<code>true</code>时会被忽略掉，初次渲染的时候<code>keep-alive</code>组件内部会将不满足条件的则直接返回<code>vnode</code>，满足缓存条件的组件通过对象<code>cache</code>将<code>vnode</code>缓存起来，已经缓存过的直接将缓存的<code>vnode</code>的<code>componentInstance</code>（组件实例）覆盖到目前的<code>vnode</code>上面，下面是代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// keep-alive.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> 'keep<span class="token operator">-</span>alive<span class="token punctuation">,</span>
    <span class="token literal-property property">abstract</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">include</span><span class="token operator">:</span> patternTypes<span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> patternTypes<span class="token punctuation">,</span>
        <span class="token literal-property property">max</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Number<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 存储缓存</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">destroyed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token comment">// 通过pruneCacheEntry清除缓存</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 观测缓存变化通过pruneCache更新缓存</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'include'</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'exclude'</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> slot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default <span class="token comment">// 获取默认插槽</span>
        <span class="token keyword">const</span> <span class="token literal-property property">vnode</span><span class="token operator">:</span> VNode <span class="token operator">=</span> <span class="token function">getFirstComponentChild</span><span class="token punctuation">(</span>slot<span class="token punctuation">)</span> <span class="token comment">// 拿到第一个元素</span>
        <span class="token keyword">const</span> <span class="token literal-property property">componentOptions</span><span class="token operator">:</span> <span class="token operator">?</span>VNodeComponentOptions <span class="token operator">=</span> vnode <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>componentOptions
        <span class="token keyword">if</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// check pattern</span>
        <span class="token keyword">const</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span>componentOptions<span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> include<span class="token punctuation">,</span> exclude <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
            <span class="token comment">// not included</span>
            <span class="token punctuation">(</span>include <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>name <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>include<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
            <span class="token comment">// excluded</span>
            <span class="token punctuation">(</span>exclude <span class="token operator">&amp;&amp;</span> name <span class="token operator">&amp;&amp;</span> <span class="token function">matches</span><span class="token punctuation">(</span>exclude<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> vnode <span class="token comment">// 无法命中缓存返回vnode</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> <span class="token punctuation">{</span> cache<span class="token punctuation">,</span> keys <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">const</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> vnode<span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token keyword">null</span>
            <span class="token comment">// same constructor may get registered as different local components</span>
            <span class="token comment">// so cid alone is not enough (#3269)</span>
            <span class="token operator">?</span> componentOptions<span class="token punctuation">.</span>Ctor<span class="token punctuation">.</span>cid <span class="token operator">+</span> <span class="token punctuation">(</span>componentOptions<span class="token punctuation">.</span>tag <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">::</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>componentOptions<span class="token punctuation">.</span>tag<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">)</span>
            <span class="token operator">:</span> vnode<span class="token punctuation">.</span>key
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 缓存已经存在</span>
            vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>componentInstance
            <span class="token comment">// make current key freshest</span>
            <span class="token function">remove</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
            keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 未缓存过</span>
            cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> vnode
            keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
            <span class="token comment">// prune oldest entry</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max <span class="token operator">&amp;&amp;</span> keys<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keys<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_vnode<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
            vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>keepAlive <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> vnode <span class="token operator">||</span> <span class="token punctuation">(</span>slot <span class="token operator">&amp;&amp;</span> slot<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// pruneCache</span>
<span class="token keyword">function</span> <span class="token function">pruneCache</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">cache</span><span class="token operator">:</span> VNodeCache<span class="token punctuation">,</span> <span class="token literal-property property">current</span><span class="token operator">:</span> VNode<span class="token punctuation">,</span> <span class="token literal-property property">filter</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token literal-property property">cachedNode</span><span class="token operator">:</span> <span class="token operator">?</span>VNode <span class="token operator">=</span> cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token operator">?</span>string <span class="token operator">=</span> <span class="token function">getComponentName</span><span class="token punctuation">(</span>cachedNode<span class="token punctuation">.</span>componentOptions<span class="token punctuation">)</span>
            <span class="token comment">//  无法匹配则清除缓存 </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">filter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedNode <span class="token operator">!==</span> current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span>cachedNode<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
<span class="token comment">// pruneCacheEntry</span>
<span class="token keyword">function</span> <span class="token function">pruneCacheEntry</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vnode</span><span class="token operator">:</span> <span class="token operator">?</span>VNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>第一次渲染时和普通渲染没有什么区别，但是后续渲染时，会将缓存的DOM插入父元素中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// patch 过程会执行 createComponent</span>
<span class="token keyword">function</span> <span class="token function">createComponent</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> refElm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> isReactivated <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> i<span class="token punctuation">.</span>keepAlive
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">i</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token comment">/* hydrating */</span><span class="token punctuation">)</span> 
        <span class="token punctuation">}</span>
        <span class="token comment">// 首次渲染vnode.componentInstance为undefined，后续渲染 vnode.componentInstance === cache[key].componentInstance</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>componentInstance<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">initComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
            <span class="token function">insert</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span> <span class="token comment">// 这部将缓存的DOM（vnode.elm）插入父元素中</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>isReactivated<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reactivateComponent</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> parentElm<span class="token punctuation">,</span> refElm<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h2> <p>持续更新...(感觉有些模块可以抽出来细究)</p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#前言" title="前言">前言</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#vue、react异同" title="Vue、React异同">Vue、React异同</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#mvvm是什么-和mvc区别" title="MVVM是什么?和MVC区别?">MVVM是什么?和MVC区别?</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#生命周期" title="生命周期">生命周期</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#子父组件通信" title="子父组件通信">子父组件通信</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#双向绑定原理" title="双向绑定原理">双向绑定原理</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#computed、watch差异" title="computed、watch差异">computed、watch差异</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#异步队列、-nexttick" title="异步队列、$nextTick">异步队列、$nextTick</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#v-for中key的作用" title="v-for中key的作用">v-for中key的作用</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#v-if、v-show差异" title="v-if、v-show差异">v-if、v-show差异</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#vue组件中data必须是函数" title="Vue组件中data必须是函数">Vue组件中data必须是函数</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#vue初始化页面闪动问题" title="Vue初始化页面闪动问题">Vue初始化页面闪动问题</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#vue、react路由模式" title="Vue、React路由模式">Vue、React路由模式</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#vue-router路由钩子函数" title="vue-router路由钩子函数">vue-router路由钩子函数</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#vue如何动态路由" title="Vue如何动态路由">Vue如何动态路由</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#keep-alive" title="keep-alive">keep-alive</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#结语" title="结语">结语</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/xwei111/chJouBlog" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li><li class="contact-item" data-v-3d9deeb8><a href="mailto:17681828640@163.com" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail" data-v-3d9deeb8><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-v-3d9deeb8></path><polyline points="22,6 12,13 2,6" data-v-3d9deeb8></polyline></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8>追旅 © 2020</li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/chJouBlog/assets/js/app.a36f641d.js" defer></script><script src="/chJouBlog/assets/js/15.7ee24ca2.js" defer></script><script src="/chJouBlog/assets/js/3.cd33b386.js" defer></script><script src="/chJouBlog/assets/js/27.5a038b7d.js" defer></script>
  </body>
</html>
