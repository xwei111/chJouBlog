(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{536:function(s,a,t){s.exports=t.p+"assets/img/1.f4935112.png"},537:function(s,a,t){s.exports=t.p+"assets/img/2.d675a861.png"},651:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("聊一下"),a("code",[s._v("WeakMap")]),s._v("弱引用，看了写文章发现很多说的不对，给出的"),a("code",[s._v("demo")]),s._v("经过尝试也是错误的，哎，难搞也要搞")]),s._v(" "),a("h2",{attrs:{id:"弱引用-vs-强引用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#弱引用-vs-强引用"}},[s._v("#")]),s._v(" 弱引用 vs 强引用")]),s._v(" "),a("p",[s._v("对象被强引用则不会被垃圾回收机制回收，这没啥说的。那到底啥事弱引用呢？")]),s._v(" "),a("p",[s._v("垃圾回收机制最常用的方法就是引用计数，只要有引用堆内存的地方，引用计数就要加1。如果一个值的引用次数是0，就表示这个值不再用到了，因此可以将这块内存释放")]),s._v(" "),a("p",[s._v("弱引用则可以理解为引用计数不会+1，看一下实际表现")]),s._v(" "),a("h2",{attrs:{id:"map-vs-weakmap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#map-vs-weakmap"}},[s._v("#")]),s._v(" Map vs WeakMap")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" m "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WeakMap")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("arr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'data'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),s._v("\n")])])]),a("p",[s._v("网上有人说"),a("code",[s._v("m.get('f')")]),s._v("等到的是"),a("code",[s._v("undefined")]),s._v("所以是弱引用，但其实你使用"),a("code",[s._v("Map")]),s._v("得到的也是"),a("code",[s._v("undefined")]),s._v("，这种说法还非常的多，不能说他说的不对吧，简直就是胡说八道。")]),s._v(" "),a("p",[s._v("回归正传，看一下为啥说"),a("code",[s._v("WeakMap")]),s._v("是弱引用。打开"),a("code",[s._v("F12")]),s._v("，选择"),a("code",[s._v("内存(memory)")]),s._v("，点击小圆点获取快照，然后搜索"),a("code",[s._v("Foo")]),s._v("，发现并没有表示其已经被回收")]),s._v(" "),a("p",[a("img",{attrs:{src:t(536),alt:"An image"}})]),s._v(" "),a("p",[s._v("而后将"),a("code",[s._v("WeakMap")]),s._v("改为"),a("code",[s._v("Map")]),s._v("重新获取快照，发现"),a("code",[s._v("Foo")]),s._v("没有被回收")]),s._v(" "),a("p",[a("img",{attrs:{src:t(537),alt:"An image"}})]),s._v(" "),a("p",[s._v("这个方式可以很直观的表明"),a("code",[s._v("WeakMap")]),s._v("的弱引用")])])}),[],!1,null,null,null);a.default=n.exports}}]);